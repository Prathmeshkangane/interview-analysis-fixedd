<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Mock Interview System</title>
    <link rel="stylesheet" href="/static/css/style.css">
</head>

<body>
    <div class="container">
        <header>
            <h1>üéØ AI-Powered Mock Interview System</h1>
            <p>Upload your resume and job description to get started</p>
        </header>

        <div class="upload-section">
            <form id="uploadForm" enctype="multipart/form-data">
                <div class="form-group">
                    <label for="resume">üìÑ Upload Your Resume</label>
                    <input type="file" id="resume" name="resume" accept=".pdf,.docx,.txt" required>
                    <small id="resumeLabel">Accepted formats: PDF, DOCX, TXT</small>
                </div>

                <div class="form-group">
                    <label for="job_description">üìã Upload Job Description</label>
                    <input type="file" id="job_description" name="job_description" accept=".pdf,.docx,.txt" required>
                    <small id="jdLabel">Accepted formats: PDF, DOCX, TXT</small>
                </div>

                <button type="submit" class="btn-primary" id="startBtn">
                    Start Interview
                </button>
            </form>

            <div id="loading" style="display: none;">
                <div class="spinner"></div>
                <p>Processing your documents and generating personalized questions...</p>
                <p class="loading-details">This may take 10-20 seconds</p>
            </div>

            <div id="error" class="error-message" style="display: none;"></div>
        </div>

        <div class="features">
            <div class="feature">
                <h3>üé§ Real-time Analysis</h3>
                <p>Record your answers with mic controls</p>
            </div>
            <div class="feature">
                <h3>üìπ Video Interview</h3>
                <p>Practice with your webcam like a real interview</p>
            </div>
            <div class="feature">
                <h3>üìä Detailed Report</h3>
                <p>Get comprehensive feedback on your performance</p>
            </div>
            <div class="feature">
                <h3>üéØ Personalized Questions</h3>
                <p>5 Resume-based questions tailored to YOUR profile</p>
            </div>
        </div>

        <div class="info-box">
            <h3>üìù What to Expect:</h3>
            <ul>
                <li><strong>5 Personalized Questions:</strong> All questions are specifically tailored to your resume
                    and the job description you provided</li>
                <li><strong>Recording Control:</strong> Start/stop recording for each answer</li>
                <li><strong>Video Display:</strong> See yourself like in Zoom</li>
                <li><strong>Real-time Feedback:</strong> Score after each question</li>
                <li><strong>Final Report:</strong> Downloadable PDF with detailed analysis</li>
            </ul>
        </div>
    </div>

    <script>
        document.getElementById('uploadForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const formData = new FormData();
            const resume = document.getElementById('resume').files[0];
            const jd = document.getElementById('job_description').files[0];

            if (!resume || !jd) {
                showError('Please upload both files');
                return;
            }

            formData.append('resume', resume);
            formData.append('job_description', jd);

            // Show loading
            document.getElementById('uploadForm').style.display = 'none';
            document.getElementById('loading').style.display = 'block';
            document.getElementById('error').style.display = 'none';

            try {
                const response = await fetch('/upload', {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();

                if (data.success) {
                    // Redirect to interview page
                    window.location.href = `/interview/${data.session_id}`;
                } else {
                    showError(data.error || 'Upload failed');
                    resetForm();
                }
            } catch (error) {
                showError('Error: ' + error.message);
                resetForm();
            }
        });

        function showError(message) {
            const errorDiv = document.getElementById('error');
            if (errorDiv) {
                errorDiv.textContent = message;
                errorDiv.style.display = 'block';
            }
        }

        function resetForm() {
            const uploadForm = document.getElementById('uploadForm');
            const loading = document.getElementById('loading');

            if (uploadForm) {
                uploadForm.style.display = 'block';
            }
            if (loading) {
                loading.style.display = 'none';
            }
        }

        // File input labels
        const resumeInput = document.getElementById('resume');
        const resumeLabel = document.getElementById('resumeLabel');

        if (resumeInput && resumeLabel) {
            resumeInput.addEventListener('change', function (e) {
                const fileName = e.target.files[0]?.name;
                if (fileName) {
                    resumeLabel.textContent = `Selected: ${fileName}`;
                }
            });
        }

        const jdInput = document.getElementById('job_description');
        const jdLabel = document.getElementById('jdLabel');

        if (jdInput && jdLabel) {
            jdInput.addEventListener('change', function (e) {
                const fileName = e.target.files[0]?.name;
                if (fileName) {
                    jdLabel.textContent = `Selected: ${fileName}`;
                }
            });
        }
    </script>
</body>

</html>